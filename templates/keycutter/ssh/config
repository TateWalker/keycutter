# ~/.keycutter/ssh/config
#
# SSH Config file for keycutter
#
# Sourced by the following line in ~/.ssh/config (added by keycutter):
#
#   Include ~/.keycutter/ssh/config

# LC_KEYCUTTER_ORIGIN
#
# - Environment variable containing hostname of "origin" machine.
# - Defines whether Identityfile should reference private or public keys (for ssh-agent).
# - By default, sshd only permits SendEnv with to use LANG, LC_*, and TERM.
#
# You need to set this in your shell profile or similar:
#
#   export LC_KEYCUTTER_ORIGIN="$(hostname -s)"
#   export LC_KEYCUTTER_ORIGIN="$USER"

SendEnv LC_KEYCUTTER_ORIGIN
SendEnv LC_KEYCUTTER_DEFAULT_KEY

# Setup ssh-agent with keys symlinked in ssh/agent/default/keys
Match exec "bash -c '[[ $LC_KEYCUTTER_ORIGIN == %L ]]'" # Connecting from Origin
    PermitLocalCommand yes
    LocalCommand /bin/bash -c '~/keycutter/bin/ssh-agent-ensure ~/.keycutter/ssh/agents/default'
    IdentityAgent ~/.keycutter/ssh/agents/default/ssh-agent.socket

    IdentityFile ~/.keycutter/ssh/keys/%k@${LC_KEYCUTTER_ORIGIN}
    IdentityFile ~/.keycutter/ssh/keys/${LC_KEYCUTTER_DEFAULT_KEY}@${LC_KEYCUTTER_ORIGIN}
    IdentityFile ~/.keycutter/ssh/keys/%k@keyring

Match exec "bash -c '[[ $LC_KEYCUTTER_ORIGIN != %L ]]'"
    IdentityFile ~/.keycutter/ssh/keys/%k@${LC_KEYCUTTER_ORIGIN}.pub
    IdentityFile ~/.keycutter/ssh/keys/${LC_KEYCUTTER_DEFAULT_KEY}@${LC_KEYCUTTER_ORIGIN}.pub
    IdentityFile ~/.keycutter/ssh/keys/%k@keyring.pub
#
# github.com_<username>
#
Host *github.com_*
    User git
    HostName github.com
    ForwardAgent no
    IdentitiesOnly yes

    # To get around pesky firewalls that block port 22
    # - Comment out the previous HostName line and uncomment the following lines
    # HostName ssh.github.com
    # Port 443

# Define your custom hosts here
Host *
    Include ~/.keycutter/ssh/hosts/*
