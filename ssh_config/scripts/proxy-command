#!/usr/bin/env bash

set -o errexit -o nounset -o pipefail

original_host="$1"
remote_user="$2"
remote_port="$3"

# Extract the actual hostname (remove username if present)
actual_host=$(echo "$original_host" | sed "s/_.*$//")

# Ensure ssh-agent is running and keys are loaded
"$(dirname "$0")/ssh-agent-ensure" "$actual_host"

# Set KEYCUTTER_ORIGIN to local hostname when run on origin and unset
[[ -z ${SSH_CONNECTION:-} ]] && : ${KEYCUTTER_ORIGIN:="$(hostname -s)"}

# Forward the KEYCUTTER_ORIGIN environment variable
export KEYCUTTER_ORIGIN

# Use netcat to connect to the actual host
exec nc "$actual_host" "$remote_port"
